<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MSN Hospital - Secure Portal</title>
    <link rel="stylesheet" href="style.css">
    <style>
        /* LOGIN PAGE SPECIFIC OVERRIDES */
        body { 
            font-family: 'Segoe UI', system-ui, sans-serif; 
            background: var(--gradient); 
            background-color: var(--bg);
            display: flex; justify-content: center; align-items: center; 
            min-height: 100vh; margin: 0; 
            color: var(--text);
            transition: background 0.3s, color 0.3s;
        }
        
        [data-theme="dark"] body {
            background: linear-gradient(135deg, #1e1e1e 0%, #121212 100%);
        }

        .grecaptcha-badge { visibility: hidden; opacity: 0; }

        .container { 
            text-align: center; 
            background: var(--card-bg); 
            padding: 40px; 
            border-radius: 15px; 
            box-shadow: var(--shadow); 
            max-width: 900px; width: 95%; position: relative; 
            border: 1px solid var(--border);
        }
        
        .logo { max-height: 80px; margin-bottom: 20px; }
        h1 { margin-bottom: 5px; font-weight: 700; color: var(--text); }
        p.subtitle { color: var(--secondary); margin-top: 0; }

        .grid { 
            display: grid; 
            grid-template-columns: repeat(auto-fit, minmax(220px, 1fr)); 
            gap: 20px; margin-top: 30px; 
        }
        
        .card { 
            background: var(--card-bg); 
            border: 1px solid var(--border); 
            border-radius: 12px; 
            padding: 25px; 
            cursor: pointer; 
            transition: transform 0.2s, box-shadow 0.2s, border-color 0.2s; 
            display: flex; flex-direction: column; align-items: center; justify-content: center; 
            box-shadow: 0 2px 5px rgba(0,0,0,0.05); 
            color: var(--text);
        }
        
        .card:hover { 
            transform: translateY(-5px); 
            box-shadow: var(--shadow); 
            border-color: var(--primary); 
        }
        
        .icon { font-size: 40px; margin-bottom: 15px; }
        .role-name { font-weight: 600; font-size: 1.1em; }

        .doctor-card { 
            border: 2px solid var(--primary); 
            background: rgba(0, 123, 255, 0.05); 
        }
        [data-theme="dark"] .doctor-card { background: rgba(51, 154, 240, 0.1); }

        select { 
            padding: 12px; width: 100%; margin: 15px 0; 
            border-radius: 6px; border: 1px solid var(--border); 
            font-size: 1em; background: var(--card-bg); color: var(--text); 
            cursor: pointer; 
        }

        button.login-btn { 
            background: var(--primary); color: #fff; border: none; 
            padding: 12px; width: 100%; border-radius: 6px; cursor: pointer; 
            font-weight: bold; font-size: 1em; transition: opacity 0.2s; 
        }
        button.login-btn:hover { opacity: 0.9; }
        button.login-btn:disabled { opacity: 0.6; cursor: not-allowed; }

        /* Modals */
        .modal-overlay { 
            position: fixed; top: 0; left: 0; width: 100%; height: 100%; 
            background: rgba(0,0,0,0.6); display: none; justify-content: center; 
            align-items: center; z-index: 1000; backdrop-filter: blur(4px); 
        }
        
        .modal { 
            background: var(--card-bg); 
            padding: 30px; border-radius: 12px; 
            width: 320px; text-align: center; 
            box-shadow: 0 20px 40px rgba(0,0,0,0.3); 
            border: 1px solid var(--border);
            animation: slideUp 0.3s ease-out; 
        }
        
        @keyframes slideUp { from { transform: translateY(20px); opacity: 0; } to { transform: translateY(0); opacity: 1; } }

        .otp-input { 
            font-size: 24px; letter-spacing: 5px; text-align: center; 
            width: 100%; padding: 10px; margin: 15px 0; 
            border: 1px solid var(--border); border-radius: 6px; 
            box-sizing: border-box; background: var(--card-bg); color: var(--text);
        }
        .otp-input:focus { border-color: var(--primary); outline: none; box-shadow: 0 0 0 3px rgba(0,123,255,0.2); }

        .cancel-btn {
            margin-top: 15px; border: none; background: none; 
            color: var(--secondary); cursor: pointer; text-decoration: underline;
        }

        /* Toast Notifications */
        #toast-container { position: fixed; top: 20px; right: 20px; z-index: 20000; }
        .toast { 
            background: #333; color: #fff; 
            padding: 12px 20px; border-radius: 6px; margin-bottom: 10px; 
            box-shadow: 0 4px 12px rgba(0,0,0,0.15); 
            animation: slideInRight 0.3s ease-out;
            font-size: 0.95em;
            display: flex; align-items: center; gap: 10px;
        }
        .toast.success { background: var(--success); color: white; }
        .toast.error { background: var(--danger); color: white; }
        .toast.info { background: var(--primary); color: white; }
        @keyframes slideInRight { from { transform: translateX(100%); opacity: 0; } to { transform: translateX(0); opacity: 1; } }

        /* Theme Toggle */
        .theme-toggle-wrapper {
            position: fixed; bottom: 20px; left: 20px; z-index: 10000;
            display: flex; gap: 8px; 
            background: var(--card-bg); 
            padding: 8px 12px; 
            border-radius: 30px; 
            box-shadow: 0 4px 15px rgba(0,0,0,0.15);
            border: 1px solid var(--border);
        }
        .theme-btn {
            width: 32px; height: 32px; 
            border-radius: 50%; border: none;
            cursor: pointer; display: flex; align-items: center; justify-content: center;
            font-size: 1.1rem; background: transparent; 
            color: var(--text);
            transition: all 0.2s;
        }
        .theme-btn:hover { background-color: rgba(0,0,0,0.1); transform: scale(1.1); }
        .theme-btn.active { background-color: var(--primary); color: #fff; box-shadow: 0 2px 5px rgba(0,0,0,0.2); }
    </style>
</head>

<body>

    <div id="toast-container"></div>

    <div class="container">
        <img src="logo.png" alt="MSN Hospital" class="logo" onerror="this.style.display='none'">
        <h1>MSN Cataract & IOL Hospital</h1>
        <p class="subtitle">Secure Departmental Access Portal</p>

        <div class="grid">
            <div class="card" onclick="openGatekeeper('Reception', 'reception.html')">
                <div class="icon">üñ•Ô∏è</div><div class="role-name">Reception</div>
            </div>
            <div class="card" onclick="openGatekeeper('Optometry', 'optometrist.html')">
                <div class="icon">üëÅÔ∏è</div><div class="role-name">Optometrist</div>
            </div>
            <div class="card" onclick="openGatekeeper('Records', 'records.html')">
                <div class="icon">üìÇ</div><div class="role-name">Records</div>
            </div>
            <div class="card" style="border-left: 4px solid var(--success);" onclick="openGatekeeper('Admin', 'dashboard.html')">
                <div class="icon">üìä</div><div class="role-name">Analytics</div>
            </div>

            <div class="card doctor-card">
                <div class="icon">ü©∫</div><div class="role-name">Doctor Login</div>
                <select id="doc_select">
                    <option value="">-- Select Name --</option>
                    <option>Dr. Jayanta Boroowa</option>
                    <option>Dr. Pratibha Chauhan Paul</option>
                    <option>Dr. Nilutpal Borah</option>
                    <option>Dr. Nilakshi Baruah</option>
                    <option>Dr. Sanjay Kr Buragohain</option>
                </select>
                <button class="login-btn" onclick="initiateLogin()">Secure Login</button>
            </div>
        </div>

        <p style="margin-top:40px; font-size:0.8em; color:var(--secondary);">
            ¬© 2026 MSN Hospital System v2.8 | System Status: <span style="color:var(--success)">‚óè Online</span>
        </p>
    </div>

    <div id="recaptcha-container"></div>

    <div class="modal-overlay" id="otpModal">
        <div class="modal">
            <h3>Identity Verification</h3>
            <p style="font-size:0.9em; color:var(--secondary)">Enter the 6-digit code sent to your mobile</p>
            <input type="tel" id="otpCode" class="otp-input" maxlength="6" placeholder="‚Ä¢ ‚Ä¢ ‚Ä¢ ‚Ä¢ ‚Ä¢ ‚Ä¢" 
                   inputmode="numeric" pattern="[0-9]*"
                   oninput="this.value = this.value.replace(/[^0-9]/g, '')"
                   onkeypress="if(event.key==='Enter') verifyOtp()">
            
            <button class="login-btn" onclick="verifyOtp()">Verify & Enter</button>
            <button class="cancel-btn" onclick="closeModal('otpModal')">Cancel</button>
        </div>
    </div>

    <div class="modal-overlay" id="pinModal">
        <div class="modal">
            <h3><span id="dept-name"></span> Access</h3>
            <p style="font-size:0.9em; color:var(--secondary)">Enter Department PIN</p>
            <input type="password" id="pinCode" class="otp-input" maxlength="4" placeholder="PIN" 
                   inputmode="numeric" pattern="[0-9]*"
                   oninput="this.value = this.value.replace(/[^0-9]/g, '')"
                   onkeypress="if(event.key==='Enter') verifyPin()">
            
            <button class="login-btn" onclick="verifyPin()">Access</button>
            <button class="cancel-btn" onclick="closeModal('pinModal')">Cancel</button>
        </div>
    </div>

    <div class="theme-toggle-wrapper">
        <button class="theme-btn" data-theme-btn="light" onclick="setTheme('light')" title="Light">‚òÄÔ∏è</button>
        <button class="theme-btn" data-theme-btn="dark" onclick="setTheme('dark')" title="Dark">üåô</button>
        <button class="theme-btn" data-theme-btn="high-contrast" onclick="setTheme('high-contrast')" title="Contrast">üëÅÔ∏è</button>
    </div>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
        import { getAuth, signInWithPhoneNumber, RecaptchaVerifier } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js";
        
        const firebaseConfig = { apiKey: "AIzaSyBne_-4FcG5DjtUDVwdd1K-XDsHjX0JOEo", authDomain: "msn-hospital.firebaseapp.com", projectId: "msn-hospital", storageBucket: "msn-hospital.firebasestorage.app", messagingSenderId: "525072218332", appId: "1:525072218332:web:5940ec924f59db675adc19", measurementId: "G-FXXZ7STWDJ" };
        const app = initializeApp(firebaseConfig); const auth = getAuth(app);
        
        const doctorPhones = { 
            "Dr. Jayanta Boroowa": "+918638370107", 
            "Dr. Pratibha Chauhan Paul": "+918638370107", 
            "Dr. Nilutpal Borah": "+918638370107", 
            "Dr. Nilakshi Baruah": "+918638370107", 
            "Dr. Sanjay Kr Buragohain": "+918638370107" 
        };
        
        const DEPT_PIN = "1234"; // Hardcoded for internal use

        let confirmationResult = null;
        let targetUrl = "";

        // CLEAR OLD SESSIONS ON LOAD
        window.onload = function() {
            localStorage.removeItem('loggedInDoctor');
        };

        // UI Helpers
        window.showToast = function(msg, type='info') {
            const t = document.createElement('div'); t.className = `toast ${type}`; t.innerText = msg;
            document.getElementById('toast-container').appendChild(t); 
            setTimeout(() => t.remove(), 3000);
        };
        window.closeModal = (id) => document.getElementById(id).style.display = 'none';

        // --- DOCTOR LOGIN ---
        window.setupRecaptcha = function() { 
            if (!window.recaptchaVerifier) { window.recaptchaVerifier = new RecaptchaVerifier(auth, 'recaptcha-container', { 'size': 'invisible' }); } 
        };

        window.initiateLogin = function() {
            const docName = document.getElementById('doc_select').value; 
            if (!docName) { showToast("Please select your name first.", "error"); return; }
            const phoneNumber = doctorPhones[docName]; 
            if (!phoneNumber) { showToast("Phone number not configured.", "error"); return; }
            
            // Fix: Specific Button Selector
            const btn = document.querySelector('.doctor-card .login-btn'); 
            const originalText = btn.innerText; 
            btn.innerText = "Verifying..."; btn.disabled = true;
            
            setupRecaptcha();
            signInWithPhoneNumber(auth, phoneNumber, window.recaptchaVerifier)
                .then((result) => {
                    confirmationResult = result; 
                    btn.innerText = originalText; btn.disabled = false;
                    document.getElementById('otpModal').style.display = 'flex'; 
                    document.getElementById('otpCode').value = ''; 
                    document.getElementById('otpCode').focus();
                }).catch((error) => { 
                    console.error(error); 
                    showToast("‚ö†Ô∏è Access Denied: " + error.message, "error"); 
                    btn.innerText = originalText; btn.disabled = false;
                    if(window.recaptchaVerifier) { window.recaptchaVerifier.clear(); window.recaptchaVerifier = null; }
                });
        };

        window.verifyOtp = function() {
            if (!confirmationResult) {
                showToast("Session expired. Please login again.", "error");
                closeModal('otpModal');
                return;
            }

            const code = document.getElementById('otpCode').value; 
            if (code.length < 6) { showToast("Enter complete 6-digit code.", "error"); return; }
            
            confirmationResult.confirm(code).then((result) => { 
                localStorage.setItem('loggedInDoctor', document.getElementById('doc_select').value); 
                window.location.href = 'doctor.html'; 
            }).catch((error) => { showToast("‚ùå Incorrect OTP.", "error"); });
        };

        // --- STAFF PIN LOGIC ---
        window.openGatekeeper = function(dept, url) {
            targetUrl = url;
            document.getElementById('dept-name').innerText = dept;
            document.getElementById('pinModal').style.display = 'flex';
            document.getElementById('pinCode').value = '';
            document.getElementById('pinCode').focus();
        };

        window.verifyPin = function() {
            const entered = document.getElementById('pinCode').value;
            if(entered === DEPT_PIN) {
                window.location.href = targetUrl;
            } else {
                showToast("‚ùå Incorrect PIN Access Denied", "error");
                document.getElementById('pinCode').value = '';
            }
        };
    </script>

    <script>
        const savedTheme = localStorage.getItem('app-theme') || 'light';
        document.documentElement.setAttribute('data-theme', savedTheme);
        updateActiveButton(savedTheme);

        window.setTheme = function(theme) {
            document.documentElement.setAttribute('data-theme', theme);
            localStorage.setItem('app-theme', theme);
            updateActiveButton(theme);
        }

        function updateActiveButton(theme) {
            document.querySelectorAll('.theme-btn').forEach(btn => 
                btn.classList.toggle('active', btn.dataset.themeBtn === theme)
            );
        }
    </script>
</body>
</html>